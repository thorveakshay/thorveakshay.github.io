{% if site.google_analytics %}
<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
    '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', '{{ site.google_analytics }}']);
  _gaq.push(['_trackPageview']);

  (function () {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
{% endif %}

<!-- gist embed -->
{% if page.gistembed %}
{% include gist_embed.html %}
{% endif %}

<!-- disqus comments -->
{% if page.comments %}{% include disqus_comments.html %}{% endif %}

<!-- MermaidJS support -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize mermaid
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default'
    });

    // Find all code blocks that might be mermaid
    // Jekyll/Kramdown outputs: <div class="language-mermaid highlighter-rouge">
    var mermaidContainers = document.querySelectorAll('.language-mermaid');

    if (mermaidContainers.length === 0) return;

    // Process each container
    mermaidContainers.forEach(function (container, index) {
      // Find the code element inside
      var codeElement = container.querySelector('pre code') || container.querySelector('code');

      if (!codeElement) return;

      // Get the mermaid code
      var code = codeElement.textContent;

      // Create a new div for mermaid
      var div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = code;
      div.id = 'mermaid-diagram-' + index;

      // Replace the entire container
      container.replaceWith(div);
    });

    // Now render all mermaid diagrams
    mermaid.run({
      querySelector: '.mermaid'
    });
  });
</script>