{% if site.google_analytics %}
<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
    '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', '{{ site.google_analytics }}']);
  _gaq.push(['_trackPageview']);

  (function () {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
{% endif %}

<!-- gist embed -->
{% if page.gistembed %}
{% include gist_embed.html %}
{% endif %}

<!-- disqus comments -->
{% if page.comments %}{% include disqus_comments.html %}{% endif %}

<!-- MermaidJS support -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

  // Configure mermaid
  mermaid.initialize({
    startOnLoad: false, // We will manually run it after converting code blocks
    theme: 'default'
  });

  document.addEventListener('DOMContentLoaded', async function () {
    // Select all code blocks that might be mermaid
    // Jekyll often outputs: <div class="language-mermaid">...<pre><code>...
    // Or: <pre><code class="language-mermaid">...
    var mermaidBlocks = document.querySelectorAll('pre code.language-mermaid, .language-mermaid pre code');

    if (mermaidBlocks.length === 0) return;

    // Convert them to <div class="mermaid">
    mermaidBlocks.forEach(function (block) {
      var div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = block.textContent;

      // Find the container to replace
      // If inside <pre>, replace the <pre>
      // If inside <div class="highlighter-rouge">, replace that
      var container = block.closest('div.highlighter-rouge') || block.closest('pre');
      if (container) {
        container.replaceWith(div);
      } else {
        block.replaceWith(div);
      }
    });

    // Run mermaid on the new .mermaid elements
    await mermaid.run({
      nodes: document.querySelectorAll('.mermaid')
    });
  });
</script>